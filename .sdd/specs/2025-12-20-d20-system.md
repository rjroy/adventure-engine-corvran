---
version: 1.1.0
status: Under Review
created: 2025-12-20
last_updated: 2025-12-20
authored_by:
  - Claude (Reverse-Engineered)
reviewed_by:
  - User (Design Decisions)
---

# d20-System Plugin Specification

**Reverse-Engineered**: true
**Source Module**: d20-system

## Executive Summary

The d20-system plugin provides a comprehensive implementation of SRD 5.2-compatible d20 RPG mechanics for Adventure Engine adventures. This plugin enables game masters to run tabletop RPG sessions with full mechanical support for character creation, combat resolution, spellcasting, monster/NPC creation, and authoritative rule lookups from the System Reference Document 5.2.1.

The plugin follows a modular skill-based architecture where each major game subsystem (players, combat, magic, monsters, rules) is encapsulated in a dedicated skill with reference documentation. It integrates with the corvran plugin's dice-roller for consistent randomization across all mechanical operations. The plugin is designed to be initialized into adventure directories, where it provides both core rules documentation and GM guidance for running d20-based gameplay.

This specification describes the capabilities, constraints, and integration requirements for a d20 mechanics system that maintains fidelity to the SRD 5.2 while providing an accessible, narrative-focused gameplay experience within the Adventure Engine framework.

## User Story

As a **game master running an adventure in Adventure Engine**, I want **comprehensive d20 RPG mechanics support including character creation, combat, spellcasting, and NPC management**, so that **I can facilitate engaging tabletop RPG sessions with consistent rule application, balanced encounters, and authoritative rule references without needing to manually look up mechanics in external documents**.

## Stakeholders

- **Primary**: Game masters running d20-based adventures in Adventure Engine
- **Secondary**: Players creating characters and tracking progression; adventure authors designing d20-compatible content
- **Tertiary**: Adventure Engine maintainers (affected by plugin architecture decisions); SRD 5.2.1 license compliance reviewers; community contributors extending the plugin

## Success Criteria

1. Game masters can initialize d20 mechanics in an adventure directory with a single command that copies core rules and merges GM guidance
2. All SRD 5.2 core mechanics (ability checks, saving throws, attack rolls, damage, conditions, advancement) are accurately implemented and accessible through skills
3. Character creation follows SRD 5.2 format with all three ability score generation methods (standard array, random, point buy) supported
4. Combat encounters can be run with full initiative tracking, attack resolution, damage calculation, and condition management
5. Spellcasting mechanics correctly implement spell save DC, spell attack modifiers, concentration, and spell slot management for all caster classes
6. Monster/NPC stat blocks follow SRD 5.2 format with Challenge Rating validation and balanced stat generation
7. Rule lookups can retrieve authoritative SRD text from the complete System Reference Document 5.2.1 using efficient search patterns
8. All dice operations integrate with the corvran dice-roller skill for consistent randomization and JSON output parsing

## Functional Requirements

### Initialization and Setup

- **REQ-F-1**: System must provide an initialization command that copies System.md (core rules) to the adventure directory
- **REQ-F-2**: System must merge d20-CLAUDE.md (GM guidance) into the adventure's CLAUDE.md file
- **REQ-F-3**: Initialization must be idempotent (detect existing d20 guidance and skip merge if already present)
- **REQ-F-4**: System must preserve existing CLAUDE.md content when merging GM guidance

### Character Creation and Management

- **REQ-F-5**: System must support standard array ability score assignment (15, 14, 13, 12, 10, 8)
- **REQ-F-6**: System must support random ability score generation (4d6 drop lowest, six times)
- **REQ-F-7**: System must support point buy ability score generation (27 points, 8-15 range)
- **REQ-F-8**: System must calculate ability modifiers using formula: (Score - 10) / 2 rounded down
- **REQ-F-9**: System must provide character sheet template (player-template.md) with all required sections
- **REQ-F-10**: System must track character identity (name, class, level, species, background, alignment)
- **REQ-F-11**: System must track ability scores (all six with scores and modifiers)
- **REQ-F-12**: System must track combat stats (AC, HP current/max, Hit Dice, Initiative, Speed)
- **REQ-F-13**: System must track proficiencies (saving throws, skills, weapons, armor, tools, languages)
- **REQ-F-14**: System must track features and traits (class features, species traits, background feat)
- **REQ-F-15**: System must track equipment (weapons with attack/damage, armor, gear, currency)
- **REQ-F-16**: System must track spellcasting data for caster classes (ability, DC, attack bonus, slots, spells known)
- **REQ-F-17**: System must support level advancement with HP increases (rolled or fixed values per class)
- **REQ-F-18**: System must update proficiency bonus at levels 5, 9, 13, 17
- **REQ-F-19**: System must support ability score improvements at levels 4, 8, 12, 16, 19

### Combat Resolution

- **REQ-F-20**: System must support initiative rolling (1d20 + DEX modifier) with turn order determination
- **REQ-F-21**: System must support surprise mechanics (initiative with Disadvantage for surprised combatants)
- **REQ-F-22**: System must implement turn structure (Movement, Action, Bonus Action, Reaction, Free Interaction)
- **REQ-F-23**: System must support all standard actions (Attack, Dash, Disengage, Dodge, Help, Hide, Ready, Search, Study, Utilize)
- **REQ-F-24**: System must support attack rolls with formula: d20 + ability modifier + proficiency bonus vs AC
- **REQ-F-25**: System must support advantage/disadvantage (roll 2d20, take higher/lower)
- **REQ-F-26**: System must cancel advantage and disadvantage when both apply
- **REQ-F-27**: System must implement critical hits (natural 20 auto-hits, double damage dice)
- **REQ-F-28**: System must implement automatic misses (natural 1 always misses)
- **REQ-F-29**: System must calculate damage with formula: weapon dice + ability modifier
- **REQ-F-30**: System must support critical damage calculation (weapon dice x 2 + ability modifier)
- **REQ-F-31**: System must implement opportunity attacks (reaction when creature leaves reach)
- **REQ-F-32**: System must implement cover mechanics (Half: +2 AC/DEX saves, Three-Quarters: +5, Total: untargetable)
- **REQ-F-33**: System must track conditions (Blinded, Charmed, Frightened, Grappled, Incapacitated, Invisible, Paralyzed, Prone, Restrained, Stunned, Unconscious)
- **REQ-F-34**: System must implement death saving throws (d20 roll, 10+ success, <10 failure, three of either triggers outcome)
- **REQ-F-35**: System must support stabilization (DC 10 Medicine check via Help action)

### Spellcasting Mechanics

- **REQ-F-36**: System must calculate spell save DC with formula: 8 + proficiency bonus + spellcasting ability modifier
- **REQ-F-37**: System must calculate spell attack modifier with formula: proficiency bonus + spellcasting ability modifier
- **REQ-F-38**: System must track spell slots by level (1-9) for full casters
- **REQ-F-39**: System must track spell slots by level (1-5) for half casters
- **REQ-F-40**: System must implement spell slot recovery on long rest
- **REQ-F-41**: System must support cantrip scaling at levels 5, 11, 17
- **REQ-F-42**: System must implement concentration mechanics (one concentration spell at a time)
- **REQ-F-43**: System must implement concentration saving throws with DC = max(10, damage/2), capped at 30
- **REQ-F-44**: System must break concentration on new concentration spell, incapacitation, or death
- **REQ-F-45**: System must support ritual casting (10 minutes extra, no slot consumed)
- **REQ-F-46**: System must enforce component requirements (Verbal, Somatic, Material)
- **REQ-F-47**: System must allow spellcasting focus substitution for non-costly, non-consumed material components

### Monster and NPC Creation

- **REQ-F-48**: System must provide stat block template following SRD 5.2 format
- **REQ-F-49**: System must support stat block sections (name, size, type, alignment, AC, HP, Speed, abilities, traits, actions, bonus actions, reactions, legendary actions)
- **REQ-F-50**: System must provide Challenge Rating to XP and Proficiency Bonus mappings (CR 0-30)
- **REQ-F-51**: System must provide Hit Die by size mappings (Tiny: d4, Small: d6, Medium: d8, Large: d10, Huge: d12, Gargantuan: d20)
- **REQ-F-52**: System must support creature types (Aberration, Beast, Celestial, Construct, Dragon, Elemental, Fey, Fiend, Giant, Humanoid, Monstrosity, Ooze, Plant, Undead)
- **REQ-F-53**: System must provide CR benchmarks for HP, AC, attack bonus, damage per round, and save DC

### Rule Reference System

- **REQ-F-54**: System must include complete SRD 5.2.1 text in searchable markdown format
- **REQ-F-55**: System must organize SRD into logical files (Legal, Playing, CharacterCreation, Classes, Origins, Feats, Equipment, Spells, Glossary, Toolbox, MagicItems, Monsters, MonstersA-Z, Animals)
- **REQ-F-56**: System must provide efficient search patterns for spells (by name, partial name, keyword)
- **REQ-F-57**: System must provide efficient search patterns for monsters (by name, partial name, CR)
- **REQ-F-58**: System must provide efficient search patterns for magic items (by name, rarity)
- **REQ-F-59**: System must provide efficient search patterns for rules glossary (by term)
- **REQ-F-60**: System must provide efficient search patterns for class features
- **REQ-F-61**: System must provide efficient search patterns for equipment and weapon properties

### Dice Integration

- **REQ-F-62**: System must invoke corvran dice-roller skill for all randomization
- **REQ-F-63**: System must parse dice-roller JSON output (expression, rolls, modifier, total)
- **REQ-F-64**: System must provide fallback guidance when dice-roller unavailable (describe roll and request player input)
- **REQ-F-65**: System must support common d20 dice expressions (ability checks, attack rolls, damage, initiative, HP rolls)

## Non-Functional Requirements

- **REQ-NF-1** (Accuracy): All mechanics must match SRD 5.2.1 exactly (formulas, tables, conditions, spell effects)
- **REQ-NF-2** (Completeness): All 12 SRD classes must be documented with full class tables and feature descriptions
- **REQ-NF-3** (Completeness): All SRD spells must be included with full descriptions
- **REQ-NF-4** (Completeness): All SRD monsters must be included with complete stat blocks
- **REQ-NF-5** (Usability): Skills must provide triggering condition descriptions that clearly indicate when to invoke each skill
- **REQ-NF-6** (Usability): Templates must include inline comments explaining each field and providing quick reference tables
- **REQ-NF-7** (Usability): GM guidance must transform mechanics into narrative descriptions ("fingers find purchase on rain-slicked ledge" vs "rolled 18 vs DC 15")
- **REQ-NF-8** (Maintainability): Each game subsystem (players, combat, magic, monsters, rules) must be isolated in separate skill files
- **REQ-NF-9** (Maintainability): Reference documentation must be co-located with skills in references/ subdirectories
- **REQ-NF-10** (Performance): Rule lookups must use grep patterns optimized for large files (spells: 325KB, monsters: 333KB)
- **REQ-NF-11** (Performance): Search patterns must show limited context (-A N lines) to avoid overwhelming output
- **REQ-NF-12** (Consistency): All dice operations must use corvran dice-roller with identical invocation patterns
- **REQ-NF-13** (Consistency): All stat blocks must follow identical formatting (NPC template structure)
- **REQ-NF-14** (Legal Compliance): All SRD content must include CC-BY-4.0 attribution from 00_Legal.md
- **REQ-NF-15** (Integration): Plugin must declare corvran as dependency for dice-roller integration
- **REQ-NF-16** (Integration): Plugin must support Adventure Engine state file conventions (player.md, characters.md)

## Explicit Constraints (DO NOT)

- Do NOT implement homebrew rules or mechanics not present in SRD 5.2.1
- Do NOT modify SRD content (spells, monsters, classes) except to format for markdown
- Do NOT auto-roll dice without player knowledge or consent
- Do NOT make mechanical decisions for players (ability score allocation, spell choices, class features)
- Do NOT create duplicate stat blocks for the same creature
- Do NOT allow multiple concentration spells simultaneously
- Do NOT stack advantage or disadvantage from multiple sources
- Do NOT add proficiency bonus more than once to the same roll
- Do NOT exceed ability score maximum of 20 for characters (without explicit features)
- Do NOT violate action economy (one action, one bonus action, one reaction per round)
- Do NOT allow spell slot recovery except on long rest (unless class feature specifies otherwise)
- Do NOT implement non-SRD classes, spells, or monsters
- Do NOT override Adventure Engine's narrative-first design philosophy with pure mechanical play
- Do NOT implement custom scripting for RPG rules enforcement - all mechanics guidance must be delivered through Claude skills and reference files, leveraging the AI GM's judgment rather than rigid code

## Technical Context

- **Existing Stack**: Claude Code plugin system, Adventure Engine framework, corvran plugin (dice-roller dependency)
- **Integration Points**:
  - Corvran dice-roller skill (via bash script invocation at `${CLAUDE_PLUGIN_ROOT}/../corvran/skills/dice-roller/scripts/roll.sh`)
  - Adventure Engine state files (player.md, characters.md, CLAUDE.md, System.md)
  - Adventure Engine directory structure (expects initialization into adventure directory)
- **Patterns to Respect**:
  - Plugin directory structure (.claude-plugin/plugin.json, commands/, skills/, CLAUDE.md)
  - Skill frontmatter (name, description with triggering conditions)
  - Reference documentation co-location (skills/[skill-name]/references/)
  - Template-driven character/NPC creation
  - Narrative transformation of mechanical outcomes in GM guidance
  - Progressive reference loading (invoke skill first, read specific files only when needed)

## Acceptance Tests

1. **Initialization**: Running `/d20-system:init` in an empty adventure directory creates System.md and CLAUDE.md with d20 guidance; running again does not duplicate content
2. **Standard Array Character Creation**: Using d20-players skill to create a character with standard array produces a valid player.md file with ability scores (15, 14, 13, 12, 10, 8) assigned and modifiers calculated correctly
3. **Random Character Creation**: Using d20-players skill to create a character with 4d6 drop lowest invokes dice-roller six times and produces valid ability scores
4. **Attack Roll Resolution**: Given a fighter with +5 attack bonus attacking AC 15 target, invoking d20-combat skill to resolve attack correctly rolls 1d20+5 via dice-roller and determines hit/miss/crit
5. **Critical Hit Damage**: Given a longsword critical hit (1d8+3 normally), system correctly rolls 2d8+3 for critical damage
6. **Spell Save DC Calculation**: Given a level 5 wizard with INT 18 (+4) and proficiency +3, d20-magic skill correctly calculates spell save DC as 15 (8+3+4)
7. **Concentration Save**: Given a concentrating wizard taking 18 damage, system correctly calculates concentration DC as 10 (max of 10 or 18/2=9) and prompts for CON save
8. **Death Saving Throws**: Given a character at 0 HP, d20-combat skill correctly implements death save tracking (10+ success, <10 failure, natural 1 = 2 failures, natural 20 = recover 1 HP)
9. **Monster Stat Block Creation**: Using d20-monsters skill to create a CR 1 creature produces a stat block with HP (25-45), AC (13-14), attack bonus (+4 to +5) matching CR benchmarks
10. **Spell Lookup**: Using d20-rules skill to look up "Fireball" retrieves exact SRD text including level, casting time, range, components, duration, and full effect description
11. **Monster Lookup**: Using d20-rules skill to look up "Adult Red Dragon" retrieves complete stat block with all abilities, actions, and legendary actions
12. **Advantage/Disadvantage Cancellation**: Given a scenario with both advantage and disadvantage, system correctly resolves to single d20 roll
13. **Proficiency Bonus Scaling**: Character leveling from 4 to 5 correctly updates proficiency bonus from +2 to +3 in all derived stats
14. **Spell Slot Management**: Casting a level 3 spell correctly decrements available level 3 slots; long rest correctly restores all expended slots
15. **Idempotent Initialization**: Running `/d20-system:init` twice in same directory correctly detects existing "# d20 System GM Guidance" marker and skips merge

## Design Decisions

The following questions were resolved during specification review:

1. **Multiclassing Spell Slots**: Manual tracking only. The d20-rules skill provides the multiclass spellcaster table reference; the AI GM and player calculate slots from there. No automatic slot calculation.

2. **Initiative Advantage/Disadvantage**: Integrated as GM discretion. The d20-combat skill documents when initiative modifiers apply (Alert feat, surprise, etc.) and the GM applies them situationally when rolling.

3. **Optional SRD Rules**: Excluded from core by default. The complete SRD reference files include optional rules (variant encumbrance, flanking, etc.) so they can be added to a world's state if a player requests them, but they are not part of default initialization.

4. **CR Validation**: Trust GM judgment. No automated warnings when monster stats deviate from CR benchmarks. The reference tables provide guidance; the AI GM applies judgment. Adding validation tooling would complicate the system and duplicate AI reasoning.

5. **Upcasting Spells**: Assisted lookup. Spell descriptions in the SRD include "At Higher Levels" scaling text. The d20-magic skill surfaces this information and the GM applies scaling using the dice-roller. No automatic damage calculation.

**Governing Principle**: RPG rules integration is delivered through AI guidance via Claude skills and reference files. Custom scripting would over-complicate the system and actually limit the power of using an AI as the GM.

## Out of Scope

- Non-SRD content (homebrew classes, spells, monsters, races)
- Automated encounter balancing or CR calculation for custom monsters
- Digital character sheet with automatic calculation updates
- Spell slot tracking with automatic recovery triggers
- Integration with external VTT (virtual tabletop) platforms
- Automated loot generation or treasure tables
- Campaign management features (session tracking, quest logs, world building)
- Player-facing UI for character creation (system provides templates and guidance only)
- Automated combat resolution without player input
- House rules or variant rules not present in SRD 5.2.1
- Integration with non-d20 RPG systems
- Real-time dice rolling visualization
- Character builder with rules validation
- Spell slot optimization recommendations
- Tactical combat AI for monsters

---

**Next Phase**: This specification was reverse-engineered from the existing d20-system implementation. The system is currently implemented and operational. Future work may involve extending with additional SRD content or improving usability features while maintaining SRD 5.2.1 compliance.
